## Database > RDS for PostgreSQL > DB 엔진

## DB 엔진
PostgreSQL에서 버전 번호는 버전 = `X.Y`로 구성됩니다. NHN Cloud의 RDS for PostgreSQL에서는 `X`의 경우 메이저 버전을, `Y`는 마이너 버전을 나타냅니다.


### RDS에서 제공하는 DB 엔진 버전

아래에 명시된 버전을 사용할 수 있습니다.

| 버전               | 생성 제한 | 비고 |
|------------------|-------|----|
| PostgreSQL 14.6  | O     |    |
| PostgreSQL 14.15 |       |    |
| PostgreSQL 17.2  |       |    |

- [ 주의 ] PostgreSQL 14.6 버전의 경우 최신 버전으로의 업그레이드가 [권고](https://www.postgresql.org/about/news/postgresql-171-165-159-1414-1317-and-1221-released-2955/)됩니다.
    
    
### 버전 업그레이드 수행하기

버전 업그레이드는 순차적으로 진행되며, 메이저 버전 업그레이드와 마이너 버전 업그레이드 각각의 특성에 따라 서로 다른 순서로 진행될 수 있습니다. 

버전 업그레이드의 경우 순차적으로 진행되며, 메이저 버전 업그레이드와 마이너 버전 업그레이드 각각의 특성에 따라 서로 다른 순서로 진행될 수 있습니다. 

버전 업그레이드 진행 전 데이터 손실 방지를 위해 백업 수행을 권장합니다.

#### 메이저 버전 업그레이드

메이저 버전 업그레이드는 버전 번호의 첫 번째 자리를 변경하는 것을 의미합니다. 예를 들어, 14.6에서 17.2으로 업그레이드하는 것이 메이저 버전 업그레이드입니다. 

RDS for PostgreSQL에서는 메이저 버전 업그레이드는 마스터에서만 실행이 가능하며, 실행한 경우 DB 인스턴스 그룹 내 모든 DB 인스턴스에 대해 버전 업그레이드를 진행합니다.

#### 메이저 버전 업그레이드 순서

사용자는 마스터 DB 인스턴스 수정을 통해 메이저 버전 업그레이드를 진행할 수 있습니다. 
수행 순서는 다음과 같습니다.

- 마스터 DB 인스턴스에서 버전 업그레이드 사전 점검을 진행합니다. 
    - 사전 점검 결과 문제가 없는 경우 버전 업그레이드를 진행합니다.
    - 사전 점검 결과는 로그 파일 형태로 제공되며 DB 인스턴스 상세의 로그 탭에서 `pg_upgrade.log` 파일을 통해 확인할 수 있습니다.    
- DB 인스턴스 그룹 내 마스터가 단독으로 존재하는 경우, 마스터 DB 인스턴스에 대해 버전 업그레이드를 진행합니다.
    - 버전 업그레이드 진행 시 다운타임이 존재합니다.
    - 버전 업그레이드 진행 중 실패 시 복구 작업이 시도될 수 있으며, 성공 시 버전 업그레이드 진행 전 상태로 복구됩니다.
    - 버전 업그레이드 실패 후 복구 작업 실패 시 재구축을 통해 복구를 시도할 수 있습니다.
- 마스터 외 복제 관계의 DB 인스턴스(예비 마스터 포함) 중 하나의 DB 인스턴스를 선정하여 진행합니다.
    - 선정한 DB 인스턴스에 대해 버전 업그레이드를 진행합니다.
        - 예비 마스터가 있는 경우 읽기 복제본에 우선하여 버전 업그레이드를 진행합니다.
        - 버전 업그레이드에 실패하는 경우 다른 DB 인스턴스에 대해서는 버전 업그레이드를 진행하지 않으며, 해당 DB 인스턴스의 경우 재구축 작업을 통해 복구를 시도할 수 있습니다.
        - [ 주의 ] 해당 단계에서 마스터에 대한 **쓰기 부하**는 차단되며, 읽기 부하에 대해서만 처리가 가능합니다.
    - 업그레이드가 완료된 DB 인스턴스에 대해 마스터로 종류를 변경하며, 나머지 그룹 내 DB 인스턴스에 대해 업그레이드 진행 및 복제 관계를 재설정합니다.
        - 접속 주소는 변경되지 않으며, 기존 접속 주소를 통해 접속이 가능합니다.
        - 버전 업그레이드 진행 시 읽기 복제본에 대해 다운타임이 존재합니다.
        - 버전 업그레이드 중 실패 시 복제 중단 상태로 유지되며, 재구축 작업을 통해 복구를 시도할 수 있습니다.
- [ 주의 ] DB 인스턴스 그룹 내 버전 업그레이드가 성공한 DB 인스턴스와 실패한 DB 인스턴스가 공존할 수 있습니다. 실패한 DB 인스턴스의 경우 복제 관계가 중단되며, 재구축 작업을 통해 복구를 시도할 수 있습니다.



### 마이너 버전 업그레이드

마이너 버전 업그레이드는 버전 번호의 두 번째 자리를 변경하는 것을 의미합니다. 예를 들어, 14.6에서 14.15로 업그레이드하는 것이 마이너 버전 업그레이드입니다.

RDS for PostgreSQL에서는 마이너 버전 업그레이드는 마스터뿐만 아니라 슬레이브에서도 실행이 가능하며, 실행한 경우 실행한 대상 DB 인스턴스에 대해 버전 업그레이드를 진행합니다. (고가용성 구성이 완료된 마스터의 경우 예비 마스터도 함께 진행됩니다.)

#### 마이너 버전 업그레이드 순서

- 마스터에 대해 버전 업그레이드를 시도하는 경우 예비 마스터가 존재한다면 함께 버전 업그레이드를 진행합니다. 
    - 마스터 단독으로 버전 업그레이드가 진행되는 경우 다운타임이 존재합니다.
    - 예비 마스터와 함께 버전 업그레이드가 진행되는 경우 과정 중 장애 조치를 이용한 재시작이 동반되며, 순단이 발생할 수 있습니다.
- 읽기 복제본에 대해 버전 업그레이드를 진행하는 경우 해당 DB 인스턴스 단독으로 버전 업그레이드를 진행합니다.
    - 버전 업그레이드 진행 시 다운타임이 존재합니다.
    - 버전 업그레이드 진행 중 실패 시 복구 작업이 시도될 수 있으며, 성공 시 버전 업그레이드 진행 전 상태로 복구됩니다.
    - 버전 업그레이드 실패 후 복구 작업 실패 시 재구축을 통해 복구를 시도할 수 있습니다.
