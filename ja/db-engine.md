## Database > RDS for PostgreSQL > DBエンジン

## DBエンジン
PostgreSQLでバージョン番号はバージョン= `X.Y`で構成されます。NHN CloudのRDS for PostgreSQLでは、`X`の場合メジャーバージョンを、`Y`はマイナーバージョンを表します。


### RDSが提供するDBエンジンのバージョン

下記のバージョンを使用できます。


| バージョン                | 作成制限 | 備考 |
|---------------------|-------|---------|
| PostgreSQL 14.6     |  O |       |
| PostgreSQL 14.15     |       |       |
| PostgreSQL 17.2    |       |       |

- [注意] PostgreSQL 14.6バージョンの場合最新バージョンへのアップグレードが[勧告](https://www.postgresql.org/about/news/postgresql-171-165-159-1414-1317-and-1221-released-2955/)されます。
    
    
### バージョンアップグレードを実行する

バージョンアップグレードは順次行われ、メジャーバージョンアップグレードとマイナーバージョンアップグレードのそれぞれの特性によって異なる順序で行われることがあります。

バージョンアップグレードの場合、順次行われ、メジャーバージョンアップグレードとマイナーバージョンアップグレードのそれぞれの特性によって異なる順序で行われることがあります。

バージョンアップグレードを行う前に、データ損失防止のため、バックアップを行うことを推奨します。

#### メジャーバージョンアップグレード

メジャーバージョンアップグレードは、バージョン番号の最初の桁を変更することを意味します。例えば、14.6から17.2にアップグレードすることがメジャーバージョンアップグレードです。

RDS for PostgreSQLでは、メジャーバージョンアップグレードはマスターでのみ実行可能で、実行した場合、DBインスタンスグループ内のすべてのDBインスタンスに対してバージョンアップグレードを行います。

#### メジャーバージョンアップグレードの順序

ユーザーはマスターDBインスタンス修正を通じてメジャーバージョンアップグレードを進行できます。 
遂行順序は次のとおりです。

- マスターDBインスタンスでバージョンアップグレードの事前点検を進行します。 
    - 事前点検の結果、問題がない場合、バージョンアップグレードを進行します。
    - 事前点検結果はログファイルの形で提供され、DBインスタンス詳細のログタブで`pg_upgrade.log`ファイルにて確認できます。    
- DBインスタンスグループ内にマスターが単独で存在する場合、マスターDBインスタンスに対してバージョンアップグレードを行います。
    - バージョンアップグレード進の進行時、ダウンタイムが存在します。
    - バージョンアップグレードの進行中に失敗した場合、復旧作業が試行されることがあり、成功した場合、バージョンアップグレードの進行前の状態に復旧されます。
    - バージョンアップグレードに失敗した後、復旧作業に失敗した場合、再構築を通じて復旧を試みることができます。
- マスター以外の複製関係のDBインスタンス(予備マスターを含む)のうち1つのDBインスタンスを選定して進行します。
    - 選定したDBインスタンスに対してバージョンアップグレードを進行します。
        - 予備マスターがある場合、リードレプリカに優先してバージョンアップグレードを進行します。
        - バージョンアップグレードに失敗した場合、他のDBインスタンスについてはバージョンアップグレードを行わず、該当DBインスタンスの場合、再構築作業を通じて復旧を試みることができます。
        - [注意]該当段階ではマスターに対する**書き込み負荷**は遮断され、読み取り負荷に対してのみ処理が可能です。
    - アップグレードが完了したDBインスタンスに対してマスターに種類を変更し、残りのグループ内のDBインスタンスに対してアップグレード進行及び複製関係を再設定します。
        - 接続アドレスは変更されず、既存の接続アドレスで接続が可能です。
        - バージョンアップグレード進行時、リードレプリカに対してダウンタイムが存在します。
        - バージョンアップグレード中に失敗した場合、複製中断状態で維持され、再構築作業を通じて復旧を試みることができます。
- [注意] DBインスタンスグループ内でバージョンアップグレードに成功したDBインスタンスと失敗したDBインスタンスが共存することがあります。失敗したDBインスタンスの場合、複製関係が中断され、再構築作業を通じて復旧を試みることができます。



### マイナーバージョンアップグレード

マイナーバージョンアップグレードは、バージョン番号の2桁目を変更することを意味します。例えば、14.6から14.15にアップグレードすることがマイナーバージョンアップグレードです。

RDS for PostgreSQLでは、マイナーバージョンアップグレードはマスターだけでなく、スレーブでも実行可能で、実行した場合、実行した対象DBインスタンスに対してバージョンアップグレードを行います。(HA構成が完了したマスターの場合、予備マスターも一緒に行われます)。

#### マイナーバージョンアップグレード順序

- マスターに対してバージョンアップグレードを試みる際、予備マスターが存在する場合、一緒にバージョンアップグレードを進めます。
    - マスター単独でバージョンアップグレードが行われる場合、ダウンタイムが存在します。
    - 予備マスターと一緒にバージョンアップグレードが進行される場合、プロセス中にフェイルオーバーを利用した再起動が伴い、瞬断が発生する可能性があります。
- リードレプリカに対してバージョンアップグレードを行う場合、当該DBインスタンス単独でバージョンアップグレードを行います。
    - バージョンアップグレードの進行時にダウンタイムが存在します。
    - バージョンアップグレードの進行中に失敗した場合、復旧作業が試行されることがあり、成功した場合、バージョンアップグレードの進行前の状態に復旧されます。
    - バージョンアップグレードに失敗した後、復旧作業に失敗した場合、再構築を通じて復旧を試みることができます。
